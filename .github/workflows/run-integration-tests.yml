name: "Run integration tests"
on:
  push:
    branches:
      - "assignment_3"
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Get Code
        uses: actions/checkout@v3
      - name: Install Dependencies
        run: npm install
      - name: Start Docker daemon
        run: sudo service docker start
      - name: Start SQL and NodeJS on Docker
        run: docker-compose up -d
      - name: Check for services
        run: |
          docker ps
          sleep 25
          docker logs webapp_node_app_1
      - name: Logging
        run: docker logs webapp_node_app_1
      - name: Calling heatlh endpoint
        run: |
          curl -vvvv http://localhost:8080/healthz
      - name: Calling Integrations tests 
        run: npm run integration_test
      - name: Stop services
        run: docker-compose down
